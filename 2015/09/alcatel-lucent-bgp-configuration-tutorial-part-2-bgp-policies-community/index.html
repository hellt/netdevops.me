<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities |</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content><meta name=twitter:title content="Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities"><meta name=twitter:description content><meta name=twitter:creator content="@ntdvps"><meta name=Description content="DevOps applied to networking"><meta property="og:title" content="Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities"><meta property="og:description" content="In the first part of this BGP tutorial we prepared the ground by configuring eBGP/iBGP peering. We did a good job overall, yet the plain BGP peering is not something you would not normally see in production. The power of BGP is in its ability for granular management of multiple routes from multiple sources. And the tools that help BGP to handle this complex task are BGP policies at their full glory.
In this part we will discuss and practice:

BGP export/import policies for route advertisement/filtering
BGP communities operations
BGP routes aggregation: route summarization and the corresponding aggregate and atomic-aggregate path attributes
"><meta property="og:type" content="article"><meta property="og:url" content="https://netdevops.me/2015/09/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-09-23T16:41:58+00:00"><meta property="article:modified_time" content="2021-04-19T12:35:46+02:00"><meta name=application-name content="NetDevOps"><meta name=apple-mobile-web-app-title content="NetDevOps"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=192x192 href=/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=/android-chrome-512x512.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://netdevops.me/2015/09/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/netdevops.me\/2015\/09\/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community\/"},"genre":"posts","keywords":"Nokia, SROS, BGP","wordCount":7743,"url":"https:\/\/netdevops.me\/2015\/09\/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community\/","datePublished":"2015-09-23T16:41:58+00:00","dateModified":"2021-04-19T12:35:46+02:00","description":""}</script></head><body data-header-desktop data-header-mobile><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header><div class="desktop header" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=NetDevOps class="header-logo logo-svg"><img loading=lazy decoding=async class=logo src=/android-chrome-192x192.png alt=/android-chrome-192x192.png title=/android-chrome-192x192.png></a></div><div class=menu><nav><h2 class=display-hidden>Основная навигация</h2><ul class=menu-inner><li><a class=menu-item href=/posts/>Posts</a></li><li><a class=menu-item href=/tags/>Tags</a></li></ul></nav><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=Search... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><span class="svg-icon icon-search"></span></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><span class="svg-icon icon-cancel"></span></a><span class="search-button search-loading" id=search-loading-desktop><span class="svg-icon icon-loading"></span></span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div><div class="mobile header" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=NetDevOps class=header-logo><img loading=lazy decoding=async class=logo src=/android-chrome-192x192.png alt=/android-chrome-192x192.png title=/android-chrome-192x192.png></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=Search... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><span class="svg-icon icon-search"></span></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><span class="svg-icon icon-cancel"></span></a><span class="search-button search-loading" id=search-loading-mobile><span class="svg-icon icon-loading"></span></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><nav><h2 class=display-hidden>Основная навигация</h2><ul><li><a class=menu-item href=/posts/ title>Posts</a></li><li><a class=menu-item href=/tags/ title>Tags</a></li></ul></nav><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div></header><main class=main><div class="container content-article theme-classic"><div class=toc id=toc-auto><div class=toc-title>Contents</div><div class="toc-content always-active" id=toc-content-auto></div></div><article><header class=header-post><div class=post-title><div class=post-all-meta><nav class=breadcrumbs><ol><li><a href=/>Home</a></li><li>Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities</li></ol></nav><h1 class="single-title flipInX">Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities</h1><div class="post-meta summary-post-meta"><span class="post-meta-date meta-item"><span class="svg-icon icon-clock"></span><time class=timeago datetime=2015-09-23>2015-09-23</time>
</span><span class="post-meta-words meta-item"><span class="svg-icon icon-pencil"></span>7743 words</span>
<span class="post-meta-reading meta-item"><span class="svg-icon icon-stopwatch"></span>37 minutes</span></div></div></div></header><div class="article-post toc-start"><div class="content-block content-block-first content-block-position"><div class="post single"><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#adding-community>Adding community</a></li><li><a href=#show-communities>Show communities</a></li><li><a href=#operation-replace--well-known-communities>Operation replace & Well-known communities</a></li><li><a href=#removing-community>Removing community</a></li><li><a href=#matching-community>Matching community</a><ul><li><a href=#and-and-or-operators>&ldquo;AND&rdquo; and &ldquo;OR&rdquo; operators</a></li><li><a href=#expressions>Expressions</a></li><li><a href=#regular-expressions>Regular Expressions</a></li></ul></li></ul></nav></div></div><div style="margin:20px 0"><span class=post-update><span class=s>Updated on 2021-04-19</span></span></div><p>In the <a href=http://netdevops.me/2015/08/alcatel-lucent-bgp-configuration-tutorial-part-1-basic-ebgp-ibgp/ target=_blank rel="noopener noreffer">first part of this BGP tutorial</a> we prepared the ground by configuring eBGP/iBGP peering. We did a good job overall, yet the <em>plain</em> BGP peering is not something you would not normally see in production. The power of BGP is in its ability for granular management of multiple routes from multiple sources. And the tools that help BGP to handle this complex task are BGP policies at their full glory.</p><p>In this part we will discuss and practice:</p><ul><li>BGP export/import policies for route advertisement/filtering</li><li>BGP communities operations</li><li>BGP routes aggregation: route summarization and the corresponding <code>aggregate</code> and <code>atomic-aggregate</code> path attributes</li></ul><h1 id=what-are-bgp-policies-for class=headerLink><a href=#what-are-bgp-policies-for class=header-mark></a>What are BGP policies for?</h1><p>The BGP peering configuration process is simple, you saw it in <a href=http://netdevops.me/2015/08/alcatel-lucent-bgp-configuration-tutorial-part-1-basic-ebgp-ibgp/ target=_blank rel="noopener noreffer">Part 1</a>, but, frankly, no network engineer leaves a BGP router in a default &ldquo;receive all, advertise all&rdquo; state. We use BGP policies to tell the router which routes to accept and which to advertise.</p><p>This is just an example on where the BGP policies play a part, but they are used for many other tasks as well.</p><p>In BGP you can define two types of policies: Import and Export. To demonstrate where and when does a particular policy take place I paste here the BGP route processing diagram:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/4109/21639405.11c/0_84d72_94e5a74a_orig.png alt=pic title=0_84d72_94e5a74a_orig.png></p><p><strong>Export polices</strong> are used for:</p><ul><li>export routes from different protocols to BGP (like IGP routes being exported to BGP in <a href=http://netdevops.me/2015/08/alcatel-lucent-bgp-configuration-tutorial-part-1-basic-ebgp-ibgp/ target=_blank rel="noopener noreffer">Part 1</a>)</li><li>granular control of the advertised routes<ul><li>prohibit unwanted prefixes advertising</li><li>set the path attributes to a desired NLRI</li></ul></li><li>reducing control plane traffic by advertising aggregate routes</li></ul><p><strong>Import policies</strong> are used for:</p><ul><li>filtering unwanted NLRI<ul><li>by prefix, prefix-length, community value</li></ul></li><li>manipulation with the outbound traffic<ul><li>applying <code>Local-Pref</code> attribute to desired prefixes</li><li>modifying/setting <code>MED</code> value or any other transitive attribute</li></ul></li></ul><p>In SROS BGP policy configuration takes place in a router&rsquo;s policy-options context - <code>configure router policy-options</code>.</p><p>To practice with BGP policies configuration we will go through a set of tasks that an ISP engineer can be expected to do in theirs day-to-day operations. We will simulate a simple ISP scenario using the following network topology:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/9263/21639405.11c/0_85519_aeed2105_orig.png alt=pic title=0_85519_aeed2105_orig.png></p><p>Network interfaces, IGP and basic BGP configuration are done exactly the same as in the <a href=http://netdevops.me/2015/08/alcatel-lucent-bgp-configuration-tutorial-part-1-basic-ebgp-ibgp target=_blank rel="noopener noreffer">Part 1 of this series</a>. If you are interested in the final configuration output, please refer to the <a href=http://netdevops.me/2015/08/alcatel-lucent-bgp-configuration-tutorial-part-1-basic-ebgp-ibgp/#Wrapping_up target=_blank rel="noopener noreffer">Wrapping up section</a>.</p><h1 id=community-attribute class=headerLink><a href=#community-attribute class=header-mark></a>Community attribute</h1><p>Lets statr with <em>BGP communities</em> introduction. A BGP community (not <a href=https://tools.ietf.org/html/rfc4360 target=_blank rel="noopener noreffer">extended</a>) is an <strong>optional transitive BGP Path attribute</strong> that is <em>a group of destinations which share some common property</em> as per the <a href=https://tools.ietf.org/html/rfc1997 target=_blank rel="noopener noreffer">RFC 1997</a>.</p><p>I like to think of a community as <em>a label (or a tag)</em> which BGP speaker puts on a NLRI to give it a context. These labels could serve different purposes, for example:</p><ul><li>to mark/identify the prefixes originated from a specific geographic region, customer or service,</li><li>or to indicate that a specific treatment is desired like for the prefixes with the use of <code>no-export</code> or <code>no-advertise</code> community values</li><li>or could mean any other property which BGP speaker wants to communicate within an NLRI.</li></ul><p>BGP Communities are just the means to augment the specific prefixes with the metadata, they are useless until you bind some actions to them.<br>For example, you tag some prefixes with a <code>community A</code> value and others with a <code>community B</code>; then you could tell your BGP peers to, say, set the <code>Local Preference 200</code> attribute for the prefixes that have <code>community A</code> value and leave Local Preference intact for the ones marked with <code>community B</code> value. In this examples communities allowed us to set a specific action based on the community value associated with the prefixes.</p><p>Communities are represented by a <strong>community string</strong> which is a 32 bit value. <strong>First two bytes</strong> of a community attribute <strong>have to</strong> be encoded with an AS number where community was born, and the other two bytes are set by an AS network engineer as he pleases (or in other words, the community string follows this template <code>&lt;2byte-asnumber:community-value></code>).</p><blockquote><p>The community attribute values range from <code>0x0000000 (0:0)</code> through <code>0x0000FFFF (0:65535)</code>.<br>The range from <code>0xFFFF0000 (65535:0)</code> through <code>0xFFFFFFFF (65535:65535)</code> is reserved.</p></blockquote><p>Lets run our lab and refer to the following diagram before we start configuring community attributes:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/6442/21639405.11c/0_8551a_fa9ce1ee_orig.png alt=pic title=0_8551a_fa9ce1ee_orig.png></p><p>We will introduce three different communities for our customer routes:</p><ul><li><code>65510:100</code> - community for every route originated from the West side of AS 65510</li><li><code>65510:200</code> - community for every route originated from the East side of our AS 65510</li><li><code>65510:2</code> - community for the <code>Customer_2</code> routes</li></ul><h2 id=adding-community class=headerLink><a href=#adding-community class=header-mark></a>Adding community</h2><p>Community strings are configured under the <code>policy-options</code> context. Before we will be able to add communities to the prefixes, we need to:</p><ol><li>Specify the <code>prefix-lists</code> for our the routes we would like to mark with a community</li><li>Declare the community strings we want to refer later to.</li></ol><p>R5 policy config:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R5&gt;config&gt;router&gt;policy-options# info
----------------------------------------------
            prefix-list &#34;Customer_1&#34;
                prefix 10.10.55.0/24 exact
                prefix 10.10.66.0/24 exact
            exit
            prefix-list &#34;Customer_2&#34;
                prefix 172.10.55.0/24 exact
                prefix 172.10.66.0/24 exact
            exit
            community &#34;East&#34; members &#34;65510:200&#34;
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;Customer_2&#34; members &#34;65510:2&#34;
----------------------------------------------
</code></pre></td></tr></table></div></div><p>The same <code>policy-options</code> configuration block is applied to R6.</p><p>To tag the routes with a community value we have to additionally configure a <code>policy-statement</code> which will associate a community string with the selected prefixes. This policy will be later referenced in the BGP configuration as the <strong>export policy</strong>.</p><p>Consider the following <code>policy-statement "Adv_Customers_nets"</code> that is configured on R5:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R5&gt;config&gt;router&gt;policy-options# info
----------------------------------------------
&lt;prefix-lists and community strings are omitted&gt;

            policy-statement &#34;Adv_Customers_nets&#34;
## =======================================================================
                entry 10 
                    from
                        protocol direct ## matches every connected network
                    exit
                    action next-entry 
## next-entry means that upon successful completion of this action 
## we DON&#39;T stop the policy evaluation process and proceed to the next entry
                        community add &#34;West&#34; ## adding community to every direct connected route
                                             ## matched by the &#34;from&#34; statement
                    exit
                exit
## =======================================================================
                entry 20
                    from
                        prefix-list &#34;Customer_2&#34; ## matches Customer_2 routes
                    exit
                    action accept
## action &#34;accept&#34; stops policy evaluation effective immediately
## and its okay in this situation, since we have only two customers
## so if we matched &#34;Customer_2&#34; and marked it with its community, 
## then we have nothing to do else and can stop policy evaluation
                        community add &#34;Customer_2&#34;
                    exit
                exit
## =======================================================================
                entry 30
                    from
                        prefix-list &#34;Customer_1&#34;
                    exit
                    action accept
## we do not need to add communities for the Customer_1 routes, but we need to create
## an &#34;action accept&#34; for its prefixes, since the default action is deny-all
                    exit
                exit
            exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>The same policy statement configuration should be created on R6 router.</p><p>In the example above we added the community string using the <code>community add</code> operation; SROS also has additional operations provided for the community strings:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>- community add &lt;name&gt; [&lt;name&gt;...(upto 28 max)]
- community remove &lt;name&gt; [&lt;name&gt;...(upto 28 max)]
- community replace &lt;name&gt; [&lt;name&gt;...(upto 28 max)]
- no community
</code></pre></td></tr></table></div></div><p>As was explained before, the policy statement should then be applied as an <code>export</code> policy in the respective BGP configuration on both R5 and R6:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>*A:R5# configure router bgp group &#34;iBGP&#34;
*A:R5&gt;config&gt;router&gt;bgp&gt;group# export &#34;Adv_Customers_nets&#34;

*A:R6# configure router bgp group &#34;iBGP&#34;
*A:R6&gt;config&gt;router&gt;bgp&gt;group# export &#34;Adv_Customers_nets&#34;
</code></pre></td></tr></table></div></div><p>Now take a look at the <code>show router bgp summary</code> command on R5. There are 2 routes advertised to every iBGP neighbor and 2 rotes received from its fellow - R6:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>===============================================================================
BGP Summary
===============================================================================
Neighbor
                   AS PktRcvd InQ  Up/Down   State|Rcv/Act/Sent (Addr Family)
                      PktSent OutQ
-------------------------------------------------------------------------------
10.10.10.1
                65510     593    0 04h55m11s 0/0/2 (IPv4)
                          595    0
10.10.10.2
                65510     593    0 04h55m09s 0/0/2 (IPv4)
                          595    0
10.10.10.6
                65510     592    0 04h53m51s 2/2/2 (IPv4)
                          592    0
-------------------------------------------------------------------------------
</code></pre></td></tr></table></div></div><p>The BGP summary output does not disclose if any community attributes were applied to the NLRIs a BGP speaker sent or received, to verify that we should ask for a specific prefix details.</p><h2 id=show-communities class=headerLink><a href=#show-communities class=header-mark></a>Show communities</h2><p>To ensure that the correct communities were passed along with the NLRI we can leverage the <code>show router bgp routes &lt;prefix> detail</code> command and check the <code>Community</code> column in its output:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R1# show router bgp routes 172.10.55.0/24 detail
===============================================================================
 BGP Router ID:10.10.10.1       AS:65510       Local AS:65510
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes

Network        : 172.10.55.0/24
Nexthop        : 10.10.10.5
Path Id        : None
From           : 10.10.10.5
Res. Nexthop   : 10.10.99.5
Local Pref.    : 100                    Interface Name : toR5
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None
Connector      : None
Community      : 65510:2 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.5
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP
Route Source   : Internal
AS-Path        : No As-Path
Route Tag      : 0
Neighbor-AS    : N/A
Orig Validation: NotFound
Source Class   : 0                      Dest Class     : 0





A:R1# show router bgp routes 10.10.55.0/24 detail
===============================================================================
 BGP Router ID:10.10.10.1       AS:65510       Local AS:65510
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes

Network        : 10.10.55.0/24
Nexthop        : 10.10.10.5
Path Id        : None
From           : 10.10.10.5
Res. Nexthop   : 10.10.99.5
Local Pref.    : 100                    Interface Name : toR5
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None
Connector      : None
Community      : 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.5
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP
Route Source   : Internal
AS-Path        : No As-Path
Route Tag      : 0
Neighbor-AS    : N/A
Orig Validation: NotFound
Source Class   : 0                      Dest Class     : 0
</code></pre></td></tr></table></div></div><p>Everything works as expected. <code>Customer_1</code> routes are tagged with just the &ldquo;West&rdquo; community, and the <code>Customer_2</code> routes are being tagged with both &ldquo;West&rdquo; and &ldquo;Customer_2&rdquo; communities. Lets go a bit deeper and see how the community strings are carried in the BGP Updates messages:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/4214/21639405.11c/0_8551b_9f4430f3_orig.png alt=pic title=0_8551b_9f4430f3_orig.png></p><p>Community path attribute propagates across eBGP links as well. To check this we can filter the routes with a specfic community that R3 has in its BGP routes tables. Note, that R3 resides in the AS 65520 and thus is a eBGP peer:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>## show BGP routes labelled with a specific community string

A:R3# show router bgp routes community 65510:2
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path
-------------------------------------------------------------------------------
u*&gt;i  172.10.55.0/24                                     None        None
      10.0.99.0                                          None        -
      65510
*i    172.10.55.0/24                                     100         None
      10.20.20.4                                         None        -
      65510
u*&gt;i  172.10.66.0/24                                     None        None
      10.0.99.0                                          None        -
      65510
*i    172.10.66.0/24                                     100         None
      10.20.20.4                                         None        -
      65510
-------------------------------------------------------------------------------
Routes : 4
===============================================================================
</code></pre></td></tr></table></div></div><p>And of course you can use <code>show router bgp routes &lt;prefix> hunt</code> to see the verbose output of a given BGP route.</p><h2 id=operation-replace--well-known-communities class=headerLink><a href=#operation-replace--well-known-communities class=header-mark></a>Operation replace & Well-known communities</h2><p><a href=https://tools.ietf.org/html/rfc1997 target=_blank rel="noopener noreffer">RFC 1997</a> specifies the following well-known communities as the well-known communities:</p><ul><li><code>NO_EXPORT (0xFFFFFF01)</code> All routes received carrying a communities attribute containing this value MUST NOT be advertised outside a BGP confederation boundary (a stand-alone autonomous system that is not part of a confederation should be considered a confederation itself).</li><li><code>NO_ADVERTISE (0xFFFFFF02)</code> All routes received carrying a communities attribute containing this value MUST NOT be advertised to other BGP peers.</li><li><code>NO_EXPORT_SUBCONFED (0xFFFFFF03)</code> All routes received carrying a communities attribute containing this value MUST NOT be advertised to external BGP peers (this includes peers in other members autonomous systems inside a BGP confederation).</li></ul><p>You will encounter <code>no-export</code> and <code>no-advertise</code> communities quite often, as they are naturally used for route advertisement manipulations.</p><p>To demonstrate the power of the default communities I would like to introduce you to another AS 65530 which has the single-homed peering with AS 65520:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/4214/21639405.11c/0_8551c_4c86f63e_orig.png alt=pic title=0_8551c_4c86f63e_orig.png></p><p>Router R7 residing in AS 65530 has the default BGP configuration:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R7&gt;config&gt;router&gt;bgp# info 
----------------------------------------------
            group &#34;no_export_example&#34;
                peer-as 65520
                split-horizon
                neighbor 10.0.99.4
                    local-address 10.0.99.5
                exit
            exit
            no shutdown
----------------------------------------------
</code></pre></td></tr></table></div></div><p>As a result of this configuration it receives <strong>all</strong> BGP routes that R3 has in its BGP Rib-Out database:</p><p>R3 BGP routes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R3# show router bgp routes 
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path                                                        
-------------------------------------------------------------------------------
u*&gt;i  10.10.55.0/24                                      None        None
      10.0.99.0                                          None        -
      65510                                                           
*i    10.10.55.0/24                                      100         None
      10.20.20.4                                         None        -
      65510                                                           
u*&gt;i  10.10.66.0/24                                      None        None
      10.0.99.0                                          None        -
      65510                                                           
*i    10.10.66.0/24                                      100         None
      10.20.20.4                                         None        -
      65510                                                           
u*&gt;i  172.10.55.0/24                                     None        None
      10.0.99.0                                          None        -
      65510                                                           
*i    172.10.55.0/24                                     100         None
      10.20.20.4                                         None        -
      65510                                                           
u*&gt;i  172.10.66.0/24                                     None        None
      10.0.99.0                                          None        -
      65510                                                           
*i    172.10.66.0/24                                     100         None
      10.20.20.4                                         None        -
      65510                                                           
-------------------------------------------------------------------------------
Routes : 8
===============================================================================
</code></pre></td></tr></table></div></div><p>R7 BGP routes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R7# show router bgp routes 
===============================================================================
 BGP Router ID:10.30.30.7       AS:65530       Local AS:65530      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path                                                        
-------------------------------------------------------------------------------
u*&gt;i  10.10.55.0/24                                      None        None
      10.0.99.4                                          None        -
      65520 65510                                                     
u*&gt;i  10.10.66.0/24                                      None        None
      10.0.99.4                                          None        -
      65520 65510                                                     
u*&gt;i  172.10.55.0/24                                     None        None
      10.0.99.4                                          None        -
      65520 65510                                                     
u*&gt;i  172.10.66.0/24                                     None        None
      10.0.99.4                                          None        -
      65520 65510                                                     
-------------------------------------------------------------------------------
Routes : 4
===============================================================================
</code></pre></td></tr></table></div></div><p>Moreover, R7 receives all the community values with the received NLRIs. For instance, the community string <code>65510:100</code> is present for the <code>10.10.55.0/24</code> prefix:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R7# show router bgp routes 10.10.55.0/24 detail 
===============================================================================
 BGP Router ID:10.30.30.7       AS:65530       Local AS:65530      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes
 
Network        : 10.10.55.0/24
Nexthop        : 10.0.99.4
Path Id        : None                   
From           : 10.0.99.4
Res. Nexthop   : 10.0.99.4
Local Pref.    : n/a                    Interface Name : toR4
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None                 
Community      : 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.20.20.3
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : External
AS-Path        : 65520 65510 
Route Tag      : 0                      
Neighbor-AS    : 65520
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
 
</code></pre></td></tr></table></div></div><p>Lets see how by tagging the <code>10.10.55.0/24</code> prefix with the <code>no-export</code> community we can change the BGP route advertisement process. To do so I will add a policy-statement to our border router R1 which will replace the community string <code>65510:100</code> of the <code>10.10.55.0/24</code> prefix with the <code>no-export</code> one:</p><p><img loading=lazy decoding=async class=render-image src=http://img-fotki.yandex.ru/get/3902/21639405.11c/0_8551d_e4cb7869_orig.png alt=pic title=0_8551d_e4cb7869_orig.png></p><p>Lets track the community mutations of a <code>10.10.55.0/24</code> prefix. R3 receives this prefix from R1 and installs in its RIB. Community value for this prefix is <code>65510:100</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R3# show router bgp routes 10.10.55.0/24 detail 
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes
 
Network        : 10.10.55.0/24
Nexthop        : 10.0.99.0
Path Id        : None                   
From           : 10.0.99.0
Res. Nexthop   : 10.0.99.0
Local Pref.    : n/a                    Interface Name : toR1
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None                 
Community      : 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.1
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : External
AS-Path        : 65510 
Route Tag      : 0                      
Neighbor-AS    : 65510
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
</code></pre></td></tr></table></div></div><p>In order to replace the existing community value with a new one, we need to go to R1 and add the necessary policy configuration:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R1&gt;config&gt;router&gt;policy-options# info 
----------------------------------------------
            prefix-list &#34;Customer_1_55_network&#34;
                prefix 10.10.55.0/24 exact
            exit
            ## We have to specify community strings 
            ## we want to use with policy-statements
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;no-export&#34; members &#34;no-export&#34;
            policy-statement &#34;replace_with_no_exp&#34;
                entry 10
                    from
                        prefix-list &#34;Customer_1_55_network&#34;
                    exit
                    action accept                      ## it is allowed to set up to 28 communities 
                        community replace &#34;no-export&#34;  ## which will replaces all the current ones
                    exit                              
                exit
            exit
----------------------------------------------

## add new policy-statement as &#34;export&#34; policy on R1 
A:R1&gt;config&gt;router&gt;bgp# group &#34;eBGP&#34;
A:R1&gt;config&gt;router&gt;bgp&gt;group# export &#34;replace_with_no_exp&#34;


*A:R1&gt;config&gt;router&gt;bgp&gt;group# info 
----------------------------------------------
                export &#34;replace_with_no_exp&#34; 
                peer-as 65520
                split-horizon
                neighbor 10.0.99.1
                    local-address 10.0.99.0
                exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>Ok, lets see if this change was casted properly, examine R1&rsquo;s RIB-In and RIB-Out tables and watch closely the <code>Community</code> value:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R1&gt;config&gt;router&gt;bgp&gt;group# show router bgp routes 10.10.55.0/24 hunt 
===============================================================================
 BGP Router ID:10.10.10.1       AS:65510       Local AS:65510      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
-------------------------------------------------------------------------------
RIB In Entries
-------------------------------------------------------------------------------
Network        : 10.10.55.0/24
Nexthop        : 10.10.10.5
Path Id        : None                   
From           : 10.10.10.5
Res. Nexthop   : 10.10.99.5
Local Pref.    : 100                    Interface Name : toR5
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None
Community      : 65510:100  ## R1 receives this community from R5
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.5
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : Internal
AS-Path        : No As-Path
Route Tag      : 0                      
Neighbor-AS    : N/A
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
 
-------------------------------------------------------------------------------
RIB Out Entries
-------------------------------------------------------------------------------
Network        : 10.10.55.0/24
Nexthop        : 10.0.99.0
Path Id        : None                   
To             : 10.0.99.1
Res. Nexthop   : n/a
Local Pref.    : n/a                    Interface Name : NotAvailable
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None
Community      : no-export  ## R1 replaced community string 65510:100 with no-export
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.20.20.3
Origin         : IGP                    
AS-Path        : 65510 
Route Tag      : 0                      
Neighbor-AS    : 65510
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
 
-------------------------------------------------------------------------------
Routes : 2
===============================================================================
</code></pre></td></tr></table></div></div><p>Good, R1 <strong>modified</strong> the community attribute of this prefix and replaced the value it had received with a <code>no-export</code> well known community. It is important to note that <code>community replace</code> removes all communities for a prefix and sets a <code>no-export</code> instead them. So if we had >1 communities for the <code>10.10.55.0/24</code> prefix we would end up with just one <code>no-export</code> in the end.</p><p>Well, lets check with R3, how is this fella doing?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R3# show router bgp routes 10.10.55.0/24 detail 
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes
 
Network        : 10.10.55.0/24
Nexthop        : 10.0.99.0
Path Id        : None                   
From           : 10.0.99.0
Res. Nexthop   : 10.0.99.0
Local Pref.    : n/a                    Interface Name : toR1
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None                 
Community      : no-export
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.1
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : External
AS-Path        : 65510 
Route Tag      : 0                      
Neighbor-AS    : 65510
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
</code></pre></td></tr></table></div></div><p>R3 receives and uses this prefix with the <code>no-export</code> community!</p><p>Before we jump to R7 let the dust to settle and think about the propagation path of the examined prefix.</p><ul><li>R5 originates this prefix and sets community <code>West "65510:100"</code>.</li><li>R5 then advertise via its <em>BGP UPDATE</em> message this prefix with this community to all of its iBGP peers (R1, R2 and R6 are the iBGP peers of R5).</li><li>R1 (since we configured it this way) replaces community <code>West</code> with <code>no-export</code> for its eBGP peer R3, but <strong>R2 does not</strong>.</li></ul><p>This leads to an interesting situation when R2 advertises <code>10.10.55.0/24</code> prefix with its original community <code>West "65510:100"</code> so R4 selects this route as the best (because R4 prefers eBGP routes over iBGP):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R4# show router bgp routes 10.10.55.0/24 detail 
===============================================================================
 BGP Router ID:10.20.20.4       AS:65520       Local AS:65520      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Original Attributes
 
Network        : 10.10.55.0/24
Nexthop        : 10.0.99.2
Path Id        : None                   
From           : 10.0.99.2
Res. Nexthop   : 10.0.99.2
Local Pref.    : n/a                    Interface Name : toR2
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None                 
Community      : 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.2
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : External
AS-Path        : 65510 
Route Tag      : 0                      
Neighbor-AS    : 65510
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
</code></pre></td></tr></table></div></div><p>This highlights the fact that if you have more then one eBGP peers and want to communicate specific community value - you should do this on <strong>every BGP border router</strong>.</p><p>Check R7 BGP routes now. We expect that R3 does not advertise the prefix <code>10.10.55.0/24</code> to its eBGP peer R7, since it is instructed to do so by the <code>no-export</code> community:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>## making sure R3 does not advertise 10.10.55.0/24 to R7

A:R3# show router bgp neighbor 10.0.99.5 advertised-routes
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path
-------------------------------------------------------------------------------
i     10.10.66.0/24                                      n/a         None
      10.0.99.4                                          None        -
      65520 65510
i     172.10.55.0/24                                     n/a         None
      10.0.99.4                                          None        -
      65520 65510
i     172.10.66.0/24                                     n/a         None
      10.0.99.4                                          None        -
      65520 65510
-------------------------------------------------------------------------------
Routes : 3
===============================================================================



## Now check R7

A:R7# show router bgp routes 10.10.55.0/24 
===============================================================================
 BGP Router ID:10.30.30.7       AS:65530       Local AS:65530      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path                                                        
-------------------------------------------------------------------------------
No Matching Entries Found
===============================================================================
</code></pre></td></tr></table></div></div><p>As expected, no <code>10.10.55.0/24</code> prefix is advertised by R3. That is what <code>no-export</code> community for.</p><blockquote><p>Note, R3 <strong>does not</strong> advertise a route with the <code>no-export</code> to its eBGP peers, but it <strong>does advertise</strong> it to its iBGP peers:</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>## R3 advertises 10.10.55.0/24 with no-export community to iBGP peer R4
A:R3# show router bgp neighbor 10.20.20.4 advertised-routes
===============================================================================
 BGP Router ID:10.20.20.3       AS:65520       Local AS:65520
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
Flag  Network                                            LocalPref   MED
      Nexthop (Router)                                   Path-Id     Label
      As-Path
-------------------------------------------------------------------------------
i     10.10.55.0/24                                      100         None
      10.20.20.3                                         None        -
      65510
i     10.10.66.0/24                                      100         None
      10.20.20.3                                         None        -
      65510
i     172.10.55.0/24                                     100         None
      10.20.20.3                                         None        -
      65510
i     172.10.66.0/24                                     100         None
      10.20.20.3                                         None        -
      65510
-------------------------------------------------------------------------------
Routes : 4
===============================================================================
</code></pre></td></tr></table></div></div><p>The <code>no-advertise</code> community works a bit different - if a router receives a route with the <code>no-advertise</code> community it will <strong>not advertise it at all</strong> even to its iBGP peers.</p><h2 id=removing-community class=headerLink><a href=#removing-community class=header-mark></a>Removing community</h2><p>Currently R2 does not modify any routes flying off to its eBGP peer R4. Lets imagine that we now have to remove the community <code>Customer_2</code> from all the Customer_2 routes on R2 before advertising them to the AS 65520. To do so we have to perform a community <strong>remove operation</strong>.</p><p>To filter all the routes with a community string <code>65510:2</code> we could use prefix lists or filter by the community string value:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R2&gt;config&gt;router&gt;policy-options# info
----------------------------------------------
            community &#34;Customer2&#34; members &#34;65510:2&#34;
            policy-statement &#34;remove_Cust2_community&#34;
                entry 10
                    from
                        community &#34;Customer2&#34; ## filter routes with specific community value
                    exit
                    action accept
                        community remove &#34;Customer2&#34;
                    exit
                exit
            exit
----------------------------------------------


*A:R2&gt;config&gt;router&gt;bgp&gt;group# export &#34;remove_Cust2_community&#34;
*A:R2&gt;config&gt;router&gt;bgp&gt;group# info
----------------------------------------------
                export &#34;remove_Cust2_community&#34;
                peer-as 65520
                split-horizon
                neighbor 10.0.99.3
                    local-address 10.0.99.2
                exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>Now R2 selects the routes with the community value of <code>65510:2</code> and removes it before sending it to its eBGP peer R4:</p><p>The following output verifies this behavior:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R2# show router bgp routes 172.10.55.0/24 hunt
===============================================================================
 BGP Router ID:10.10.10.2       AS:65510       Local AS:65510
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
-------------------------------------------------------------------------------
RIB In Entries
-------------------------------------------------------------------------------
Network        : 172.10.55.0/24
Nexthop        : 10.10.10.5
Path Id        : None
From           : 10.10.10.5
Res. Nexthop   : 10.10.99.0
Local Pref.    : 100                    Interface Name : toR1
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None
Connector      : None
Community      : 65510:2 65510:100   ## R2 receives this prefix with 2 communities
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.5
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP
Route Source   : Internal
AS-Path        : No As-Path
Route Tag      : 0
Neighbor-AS    : N/A
Orig Validation: NotFound
Source Class   : 0                      Dest Class     : 0

-------------------------------------------------------------------------------
RIB Out Entries
-------------------------------------------------------------------------------
Network        : 172.10.55.0/24
Nexthop        : 10.0.99.2
Path Id        : None
To             : 10.0.99.3
Res. Nexthop   : n/a
Local Pref.    : n/a                    Interface Name : NotAvailable
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None
Connector      : None
Community      : 65510:100    ## on export operation R2 removes Customer_2 community
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.20.20.4
Origin         : IGP
AS-Path        : 65510
Route Tag      : 0
Neighbor-AS    : 65510
Orig Validation: NotFound
Source Class   : 0                      Dest Class     : 0

-------------------------------------------------------------------------------
Routes : 2
===============================================================================


## same thing happened to another Customer_2 route

A:R2# show router bgp routes 172.10.66.0/24 hunt 
===============================================================================
 BGP Router ID:10.10.10.2       AS:65510       Local AS:65510      
===============================================================================
 Legend -
 Status codes  : u - used, s - suppressed, h - history, d - decayed, * - valid
                 l - leaked
 Origin codes  : i - IGP, e - EGP, ? - incomplete, &gt; - best, b - backup

===============================================================================
BGP IPv4 Routes
===============================================================================
-------------------------------------------------------------------------------
RIB In Entries
-------------------------------------------------------------------------------
Network        : 172.10.66.0/24
Nexthop        : 10.10.10.6
Path Id        : None                   
From           : 10.10.10.6
Res. Nexthop   : 10.10.99.3
Local Pref.    : 100                    Interface Name : toR6
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None
Community      : 65510:2 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.10.10.6
Fwd Class      : None                   Priority       : None
Flags          : Used  Valid  Best  IGP  
Route Source   : Internal
AS-Path        : No As-Path
Route Tag      : 0                      
Neighbor-AS    : N/A
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
 
-------------------------------------------------------------------------------
RIB Out Entries
-------------------------------------------------------------------------------
Network        : 172.10.66.0/24
Nexthop        : 10.0.99.2
Path Id        : None                   
To             : 10.0.99.3
Res. Nexthop   : n/a
Local Pref.    : n/a                    Interface Name : NotAvailable
Aggregator AS  : None                   Aggregator     : None
Atomic Aggr.   : Not Atomic             MED            : None
AIGP Metric    : None                   
Connector      : None
Community      : 65510:100
Cluster        : No Cluster Members
Originator Id  : None                   Peer Router Id : 10.20.20.4
Origin         : IGP                    
AS-Path        : 65510 
Route Tag      : 0                      
Neighbor-AS    : 65510
Orig Validation: NotFound               
Source Class   : 0                      Dest Class     : 0
 
-------------------------------------------------------------------------------
Routes : 2
===============================================================================
</code></pre></td></tr></table></div></div><p>Remove operation removes a single community per action. Like in this example R2&rsquo;s RIB-In had the prefix <code>172.10.55.0/24</code> with both <code>65510:2</code> and <code>65510:200</code> values set the remove operation removed the <code>65510:2</code> community only.</p><h2 id=matching-community class=headerLink><a href=#matching-community class=header-mark></a>Matching community</h2><p>The whole thing with the communities is about performing the actions against the prefixed matched with it. As you saw previously, the action based on a community should first match the community by its value and there are several ways to do the matching.</p><p>How can you pick the routes with the different communities and modify them altogether? One way would be to write multiple policy-statements with the same action and different <code>from community &lt;name></code> statements. This is a bruteforce. There are far more elegant techniques we are going to explore.</p><h3 id=and-and-or-operators class=headerLink><a href=#and-and-or-operators class=header-mark></a>&ldquo;AND&rdquo; and &ldquo;OR&rdquo; operators</h3><p>To create a community that matches some of the community values you can use the <code>|</code> operator like that: <code>community West_or_Customer_2 members 65510:2|65510:100</code>. This community statement will match prefixes with the community strings like <code>65510:2</code>, <code>65510:2 65510:100</code> or <code>65510:2 63300:2 54487:200</code>.</p><p>To create a community statement that will match on a string that has multiple community values (aka <code>AND</code> operator) you can compose the following community statement: <code>community "A_and_B" members "65510:2" "65510:100"</code>. This community will match <code>65510:2 65510:100</code> or <code>100:100 200:200 65510:2 65510:100</code> but <strong>not</strong> <code>65510:2</code> or <code>100:100 65510:2</code>.</p><h3 id=expressions class=headerLink><a href=#expressions class=header-mark></a>Expressions</h3><p>Nokia SR-OS has the built-in expressions engine equipped with a set of most commonly used operators. The Expressions syntax is described in the Routing Protocols guide:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>community &lt;name&gt; expression &lt;expression&gt; [exact]

&lt;expression&gt;         : [900 chars max] - &lt;expression&gt; is one of the following:
                       &lt;expression&gt; {AND|OR} &lt;expression&gt;
                       [NOT] ( &lt;expression&gt; )
                       [NOT] &lt;comm-id&gt;
&lt;exact&gt;              : keyword
</code></pre></td></tr></table></div></div><p>A good example on the expressions syntax is demonstrated by the statement below which matches exactly the prefixes with agiven list of communities attached to them:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>community &#34;West_and_Cust_2_ONLY&#34; expression &#34;65510:2 AND 65510:100&#34; exact
</code></pre></td></tr></table></div></div><p>This community, once used in the <code>from</code> statement of a policy will match prefixes with the community string <code>65510:2 65510:100</code> only (enforced by the <code>exact</code> statement).</p><h3 id=regular-expressions class=headerLink><a href=#regular-expressions class=header-mark></a>Regular Expressions</h3><p>Another filtering technique is based on the regular expressions.</p><p>Let me show you how easy it is to filter the routes with a community string containing <code>65510:100</code> <strong>or</strong> <code>65510:2</code> values:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>*A:R1&gt;config&gt;router&gt;policy-options# info
----------------------------------------------
            prefix-list &#34;Customer_1_55_network&#34;
                prefix 10.10.55.0/24 exact
            exit
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;no-export&#34; members &#34;no-export&#34;
            community &#34;no-advertise&#34; members &#34;no-advertise&#34;

            ## this community string equals to the form:
            ## members list contains 65510:2 OR 65510:100
            community &#34;Customer_2_from_West&#34; members &#34;65510:(2|100)&#34;
            
            &lt;...omitted...&gt;

            policy-statement &#34;test_regexp_community&#34;
                entry 10
                    from
                        community &#34;Customer_2_from_West&#34;
                    exit
                    action accept
                        community replace &#34;no-advertise&#34;
                    exit
                exit
            exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>Here I defined the <code>Customer_2_from_West</code> community and used a simple regular expression for to match on the communities <code>65510:100</code> <strong>or</strong> <code>65510:2</code>. This regexp community string will match strings like <code>65510:2</code> , <code>65510:2 65510:100</code> , <code>65510:2 63300:2 54487:200</code></p><p>Of course you can create a far more complex regexps, check the table of the supported operators of the Routing Protocols Guide to build a regexp that meets your needs.</p><h1 id=wrapping-up class=headerLink><a href=#wrapping-up class=header-mark></a>Wrapping up</h1><p>As usual, check out the full config that you will have at the end of this tutorial:</p><p>R1:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R1&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;system&#34;
            address 10.10.10.1/32
            no shutdown
        exit
        interface &#34;toR2&#34;
            address 10.10.99.0/31
            port 1/1/1
            no shutdown
        exit
        interface &#34;toR3&#34;
            address 10.0.99.0/31
            port 1/1/3
            no shutdown
        exit
        interface &#34;toR5&#34;
            address 10.10.99.4/31
            port 1/1/4
            no shutdown
        exit
        autonomous-system 65510
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 10.10
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR2&#34;
                interface-type point-to-point
                no shutdown
            exit
            interface &#34;toR5&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;Policy Configuration&#34;
#--------------------------------------------------
        policy-options
            begin
            prefix-list &#34;Customer_1_55_network&#34;
                prefix 10.10.55.0/24 exact
            exit
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;no-export&#34; members &#34;no-export&#34;
            community &#34;no-advertise&#34; members &#34;no-advertise&#34;
            community &#34;Customer_2_from_West&#34; members &#34;65510:(2|100)&#34;
            policy-statement &#34;replace_with_no_exp&#34;
                entry 10
                    from
                        prefix-list &#34;Customer_1_55_network&#34;
                    exit
                    action accept
                        community replace &#34;no-export&#34;
                    exit
                exit
            exit
            policy-statement &#34;test_regexp_community&#34;
                entry 10
                    from
                        community &#34;Customer_2_from_West&#34;
                    exit
                    action accept
                        community replace &#34;no-advertise&#34;
                    exit
                exit
            exit
            commit
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;eBGP&#34;
                export &#34;replace_with_no_exp&#34; &#34;test_regexp_community&#34;
                peer-as 65520
                split-horizon
                neighbor 10.0.99.1
                    local-address 10.0.99.0
                exit
            exit
            group &#34;iBGP&#34;
                next-hop-self
                peer-as 65510
                neighbor 10.10.10.2
                exit
                neighbor 10.10.10.5
                exit
                neighbor 10.10.10.6
                exit
            exit
            no shutdown
        exit
</code></pre></td></tr></table></div></div><p>R2:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>A:R2&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;system&#34;
            address 10.10.10.2/32
            no shutdown
        exit
        interface &#34;toR1&#34;
            address 10.10.99.1/31
            port 1/1/1
            no shutdown
        exit
        interface &#34;toR4&#34;
            address 10.0.99.2/31
            port 1/1/3
            no shutdown
        exit
        interface &#34;toR6&#34;
            address 10.10.99.2/31
            port 1/1/4
            no shutdown
        exit
        autonomous-system 65510
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 10.10
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR1&#34;
                interface-type point-to-point
                no shutdown
            exit
            interface &#34;toR6&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;Policy Configuration&#34;
#--------------------------------------------------
        policy-options
            begin
            community &#34;Customer2&#34; members &#34;65510:2&#34;
            policy-statement &#34;remove_Cust2_community&#34;
                entry 10
                    from
                        community &#34;Customer2&#34;
                    exit
                    action accept
                        community remove &#34;Customer2&#34;
                    exit
                exit
            exit
            commit
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;eBGP&#34;
                export &#34;remove_Cust2_community&#34;
                peer-as 65520
                split-horizon
                neighbor 10.0.99.3
                    local-address 10.0.99.2
                exit
            exit
            group &#34;iBGP&#34;
                peer-as 65510
                neighbor 10.10.10.1
                exit
                neighbor 10.10.10.5
                exit
                neighbor 10.10.10.6
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>R3:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R3&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;R3_Ext_Customer&#34;
            address 172.16.33.1/24
            loopback
            no shutdown
        exit
        interface &#34;system&#34;
            address 10.20.20.3/32
            no shutdown
        exit
        interface &#34;toR1&#34;
            address 10.0.99.1/31
            port 1/1/3
            no shutdown
        exit
        interface &#34;toR4&#34;
            address 10.20.99.0/31
            port 1/1/2
            no shutdown
        exit
        interface &#34;toR7&#34;
            address 10.0.99.4/31
            port 1/1/5
            no shutdown
        exit
        autonomous-system 65520
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 20.20
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR4&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;eBGP&#34;
                export &#34;export_R3_Ext_Customer&#34;
                peer-as 65510
                split-horizon
                neighbor 10.0.99.0
                    local-address 10.0.99.1
                exit
            exit
            group &#34;iBGP&#34;
                next-hop-self
                peer-as 65520
                neighbor 10.20.20.4
                exit
            exit
            group &#34;no_export_example&#34;
                peer-as 65530
                split-horizon
                neighbor 10.0.99.5
                    local-address 10.0.99.4
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>R4:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R4&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;system&#34;
            address 10.20.20.4/32
            no shutdown
        exit
        interface &#34;toR2&#34;
            address 10.0.99.3/31
            port 1/1/3
            no shutdown
        exit
        interface &#34;toR3&#34;
            address 10.20.99.1/31
            port 1/1/2
            no shutdown
        exit
        autonomous-system 65520
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 20.20
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR3&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;eBGP&#34;
                peer-as 65510
                split-horizon
                neighbor 10.0.99.2
                    local-address 10.0.99.3
                exit
            exit
            group &#34;iBGP&#34;
                next-hop-self
                peer-as 65520
                neighbor 10.20.20.3
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>R5:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R5&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;R5_Customer_1&#34;
            address 10.10.55.1/24
            loopback
            no shutdown
        exit
        interface &#34;R5_Customer_2&#34;
            address 172.10.55.1/24
            loopback
            no shutdown
        exit
        interface &#34;system&#34;
            address 10.10.10.5/32
            no shutdown
        exit
        interface &#34;toR1&#34;
            address 10.10.99.5/31
            port 1/1/4
            no shutdown
        exit
        interface &#34;toR6&#34;
            address 10.10.99.6/31
            port 1/1/1
            no shutdown
        exit
        autonomous-system 65510
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 10.10
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR1&#34;
                interface-type point-to-point
                no shutdown
            exit
            interface &#34;toR6&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;Policy Configuration&#34;
#--------------------------------------------------
        policy-options
            begin
            prefix-list &#34;Customer_1&#34;
                prefix 10.10.55.0/24 exact
                prefix 10.10.66.0/24 exact
            exit
            prefix-list &#34;Customer_2&#34;
                prefix 172.10.55.0/24 exact
                prefix 172.10.66.0/24 exact
            exit
            community &#34;East&#34; members &#34;65510:200&#34;
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;Customer_2&#34; members &#34;65510:2&#34;
            policy-statement &#34;Adv_Customers_nets&#34;
                entry 10
                    from
                        protocol direct
                    exit
                    action next-entry
                        community add &#34;West&#34;
                    exit
                exit
                entry 20
                    from
                        prefix-list &#34;Customer_2&#34;
                    exit
                    action accept
                        community add &#34;Customer_2&#34;
                    exit
                exit
                entry 30
                    from
                        prefix-list &#34;Customer_1&#34;
                    exit
                    action accept
                    exit
                exit
            exit
            commit
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;iBGP&#34;
                export &#34;Adv_Customers_nets&#34;
                peer-as 65510
                neighbor 10.10.10.1
                exit
                neighbor 10.10.10.2
                exit
                neighbor 10.10.10.6
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>R6:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R6&gt;config&gt;router# info
----------------------------------------------
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;R6_Customer_1&#34;
            address 10.10.66.1/24
            loopback
            no shutdown
        exit
        interface &#34;R6_Customer_2&#34;
            address 172.10.66.1/24
            loopback
            no shutdown
        exit
        interface &#34;system&#34;
            address 10.10.10.6/32
            no shutdown
        exit
        interface &#34;toR2&#34;
            address 10.10.99.3/31
            port 1/1/4
            no shutdown
        exit
        interface &#34;toR5&#34;
            address 10.10.99.7/31
            port 1/1/1
            no shutdown
        exit
        autonomous-system 65510
#--------------------------------------------------
echo &#34;ISIS Configuration&#34;
#--------------------------------------------------
        isis
            level-capability level-1
            area-id 10.10
            reference-bandwidth 100000000
            level 1
                wide-metrics-only
            exit
            level 2
                wide-metrics-only
            exit
            interface &#34;system&#34;
                no shutdown
            exit
            interface &#34;toR2&#34;
                interface-type point-to-point
                no shutdown
            exit
            interface &#34;toR5&#34;
                interface-type point-to-point
                no shutdown
            exit
            no shutdown
        exit
#--------------------------------------------------
echo &#34;Policy Configuration&#34;
#--------------------------------------------------
        policy-options
            begin
            prefix-list &#34;Customer_1&#34;
                prefix 10.10.55.0/24 exact
                prefix 10.10.66.0/24 exact
            exit
            prefix-list &#34;Customer_2&#34;
                prefix 172.10.55.0/24 exact
                prefix 172.10.66.0/24 exact
            exit
            community &#34;East&#34; members &#34;65510:200&#34;
            community &#34;West&#34; members &#34;65510:100&#34;
            community &#34;Customer_2&#34; members &#34;65510:2&#34;
            policy-statement &#34;Adv_Customers_nets&#34;
                entry 10
                    from
                        protocol direct
                    exit
                    action next-entry
                        community add &#34;West&#34;
                    exit
                exit
                entry 20
                    from
                        prefix-list &#34;Customer_2&#34;
                    exit
                    action accept
                        community add &#34;Customer_2&#34;
                    exit
                exit
                entry 30
                    from
                        prefix-list &#34;Customer_1&#34;
                    exit
                    action accept
                    exit
                exit
            exit
            commit
        exit
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;iBGP&#34;
                export &#34;Adv_Customers_nets&#34;
                peer-as 65510
                neighbor 10.10.10.1
                exit
                neighbor 10.10.10.2
                exit
                neighbor 10.10.10.5
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div><p>R7:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-txt data-lang=txt>A:R7&gt;config&gt;router# info
#--------------------------------------------------
echo &#34;IP Configuration&#34;
#--------------------------------------------------
        interface &#34;system&#34;
            address 10.30.30.7/32
            no shutdown
        exit
        interface &#34;toR4&#34;
            address 10.0.99.5/31
            port 1/1/5
            no shutdown
        exit
        autonomous-system 65530
#--------------------------------------------------
echo &#34;BGP Configuration&#34;
#--------------------------------------------------
        bgp
            group &#34;no_export_example&#34;
                peer-as 65520
                split-horizon
                neighbor 10.0.99.4
                    local-address 10.0.99.5
                exit
            exit
            no shutdown
        exit
----------------------------------------------
</code></pre></td></tr></table></div></div></div><footer><div class=post><div class=post-share><div class=share-link><a class="share-icon share-twitter" href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://netdevops.me/2015/09/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community/ data-title="Nokia (Alcatel-Lucent) BGP configuration tutorial. Part 2 - Communities" data-via=ntdvps data-hashtags=Nokia,SROS,BGP><span class="svg-social-icon icon-twitter"></span></a></div><div class=share-link><a class="share-icon share-facebook" href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://netdevops.me/2015/09/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community/ data-hashtag=Nokia><span class="svg-social-icon icon-facebook"></span></a></div><div class=share-link><a class="share-icon share-linkedin" href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://netdevops.me/2015/09/alcatel-lucent-bgp-configuration-tutorial-part-2-bgp-policies-community/><span class="svg-social-icon icon-linkedin"></span></a></div></div><div class=post-tags><a href=/tags/nokia/ class=tag>Nokia</a><a href=/tags/sros/ class=tag>SROS</a><a href=/tags/bgp/ class=tag>BGP</a></div></div></footer></div><div id=toc-final></div></div></article><aside class=article-post><div class="content-block content-block-position block-donate"><div class=post><div class=title><div style=text-align:center><svg width="90" height="90" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fff" d="M376 30c-27.783.0-53.255 8.804-75.707 26.168-21.525 16.647-35.856 37.85-44.293 53.268-8.437-15.419-22.768-36.621-44.293-53.268C189.255 38.804 163.783 30 136 30 58.468 30 0 93.417.0 177.514c0 90.854 72.943 153.015 183.369 247.118l62.099 53.414C248.38 480.596 252.12 482 256 482s7.62-1.404 10.532-3.953l62.111-53.425C439.057 330.529 512 268.368 512 177.514 512 93.417 453.532 30 376 30z"/></svg></div><div style=text-align:center;margin-top:20px><span class=title>If any of my work was helpful, you can:</span></div></div><div class=donate-text><ul><li>✉️ Share this post with your colleagues</li><li>💬 Comment, ask questions and report any issues/typos found</li><li>💰 Make a one-time or recurring donation to support my work</li></ul></div><div class=donate-button><a href=https://github.com/sponsors/hellt class="button button-big button-white">Donate</a></div></div></div></aside><section class="page single comments content-block-position"><h1 class=display-hidden>Комментарии</h1><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></section></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.82.0">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://netdevops.me/&utm_medium=footer&utm_campaign=config&utm_term=2.0.1" target=_blank title="uBlogger 2.0.1">uBlogger</a></div><div class=footer-line><i class="svg-icon icon-copyright"></i><span>2015 - 2021</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><aside id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="svg-icon icon-arrow-up"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="svg-icon icon-comments-fixed"></i></a></aside><link rel=stylesheet href=/drawio.css><script src=/lib/smooth-scroll/smooth-scroll.min.js></script><script src=/lib/autocomplete/autocomplete.min.js></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script src=/lib/sharer/sharer.min.js></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:20},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"comment",lightTheme:"github-light",repo:"hellt/netdevops.me"}},search:{algoliaAppID:"H1AI8QKFEK",algoliaIndex:"blog",algoliaSearchKey:"0544bc3c928ba0e387c3b3353112e43d",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:60,type:"algolia"}}</script><script src=/js/theme.min.js></script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101537614-1','auto'),ga('send','pageview')</script></body></html>